## Домашнее задание к занятию «Микросервисы: подходы»

### Ответ на задачу №1: Обеспечить разработку

Для вышеуказанных требований подходит GitLab в связке с HashiCorp Vault:

- облачная система - GitLab возможно развернуть в облаке, например Yandex или Google;
- система контроля версий Git - GitLab основан на Git;
- репозиторий на каждый сервис - GitLab можно создавать неограниченное количество репозиториев;
- запуск сборки по событию из системы контроля версий - Запуск пайплайна возможен по событию в VCS (commit, tag creation, итд.);
- запуск сборки по кнопке с указанием параметров - Возможен ручной запуск пайплайнов;
- возможность привязать настройки к каждой сборке - В GitLab есть возможность привязывать переменные к пайплайну;
- возможность создания шаблонов для различных конфигураций сборок - GitLab поддерживает кастомизированные шаблоны;
- возможность безопасного хранения секретных данных (пароли, ключи доступа) - GitLab поддерживает интеграцию с HashiCorp Vault;
- несколько конфигураций для сборки из одного репозитория - GitLab позволяет создавать различные пайплайны для одного репозитория;
- кастомные шаги при сборке - В GitLab пайплайне можно прописывать кастомные stages;
- собственные докер-образы для сборки проектов - GitLab позволяет использовать любые образы при конфигурации docker-раннера;
- возможность развернуть агентов сборки на собственных серверах - Возможна конфигурация раннера на любом сервере (облачном и физическом);
- возможность параллельного запуска нескольких сборок - Количество параллельных запусков пайплайнов не ограничено;
- возможность параллельного запуска тестов - Количество параллельных запусков пайплайнов с тестами не ограничего.

Вместо GitLab можно использовать свои сервера Git и Jenkins

Jenkins позволяет:

- Использовать Git репозитории как основу для CI/CD;
- Настраивать pipeline в разных стилях (Freestyle, декларативный, скриптовый), в том числе настраивать условия запуска сборки;
- Все pipeline можно запускать вручную из интерфейса Jenkins;
- Каждая pipeline может иметь переменные окружения и другие параметры, настраиваемые прямо в интерфейсе Jenkins;
- Безопасно хранить секретные данные (текст или небольшие файлы);
- Позволяет создавать multibranch pipeline, фактически представляющий из себя несколько pipeline на основе веток одного репозитория;
- Все типы pipeline допускают внедрение произвольных шагов (например, запуск скриптов);
- Позволяет использовать Docker образы как для всего pipeline, так и для каждого шага в отдельности;
- Допускает развертывание любого числа агентов и instance сборки в них как на облачных ресурсах, так и собственных серверах;
- Позволяет реализовать параллельный запуск сборок при наличии доступных instance агентов.

### Ответ на задачу №2: Логи

Для вышеуказанных требований подходит ElasticSearch + LogStash + Kibana

ELK хорошо известен, просто найти инженеров, которые с ним работали, просто найти документацию и информацию, широкое комьюнити. Есть облачный вариант с поддержкой вендора.

Требование |	Функционал Elastic Stack
-----------|-----------------------------
Сбор логов в центральное хранилище со всех хостов, обслуживающих систему	| Данные хранятся централизованно в одной или нескольких локациях
Минимальные требования к приложениям, сбор логов из stdout	| LogStash имеет плагин для сбора логов из stdout
Гарантированная доставка логов до центрального хранилища	| LogStash имеет защиту от потерь данных при ненормальном завершении процесса
Обеспечение поиска и фильтрации по записям логов	| ElasticSearch это поисковая система, основаная на библиотеке Apache Lucene
Обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов	| Kibana обеспечивает пользовательский интерфейс для поиска и поддерживает язык запросов KQL
Возможность дать ссылку на сохранённый поиск по записям логов	| KQL поддерживает ссылки на сохранённые запросы

### Ответ на задачу №3: Мониторинг

Prometheus + Grafana

Причины, по которым выбираем этот стек:

- Производительное решение
- Много документации и широкое комьюнити
- Для всех популярных языков есть библиотеки, которые помогут добавить экспорт метрик собственных сервисов в формате Prometheus

Требование	| Функционал Prometheus + Grafana
------------|---------------------------------
Сбор метрик со всех хостов, обслуживающих систему	| Поддерживается неограниченное количество хостов для мониторинга
Сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network	| Сбор состояния ресурсов хостов поддерживается node-exporter
Сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network	| Экспортеры реализованы практически под все распространенное программное обеспечение
Сбор метрик, специфичных для каждого сервиса	| Можно написать свой экспортер, например на Python
Пользовательский интерфейс с возможностью делать запросы и агрегировать информацию	|Prometheus поддерживает мощный язык запросов PromQL (Prometheus Query Language) для выборки и аггрегации метрик
Пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы	| Grafana предоставляет средства визуализации и дополнительного анализа информации из Prometheus, поддерживает дашборды под любые задачи, можно создавать собственные
